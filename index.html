<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vogel-Evolution (Fertig)</title>
    <style>
        /* --- GRUNDLAGEN --- */
        body {
            font-family: 'Arial', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #333;
            color: white;
            margin: 0;
            flex-direction: column;
        }
        h1 {
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        /* --- SPIEL-BILDSCHIRM --- */
        #gameContainer {
            width: 400px;
            height: 600px;
            background-color: #70c5ce; /* Himmel-Blau */
            border: 3px solid white;
            border-radius: 8px;
            overflow: hidden; 
            position: relative;
            cursor: pointer;
        }

        /* --- VOGEL --- */
        #vogel {
            width: 50px; 
            height: 50px;
            background-image: url('vogel_1.png');
            background-size: contain;
            background-repeat: no-repeat;
            position: absolute;
            top: 250px;
            left: 75px;
            transition: transform 0.1s;
            z-index: 15;
            user-select: none; 
        }

        /* --- HINDERNISSE (ROHRE) --- */
        .obstacle {
            position: absolute;
            width: 60px;
            background-color: #73bf2e; /* Grün */
            border: 2px solid #558b21;
            z-index: 5;
        }
        .obstacle.top { border-top: 0; }
        .obstacle.bottom { border-bottom: 0; }

        /* --- ZIEL (Für Modus 2) --- */
        #target {
            width: 50px;
            height: 50px;
            background-color: #4CAF50; /* Grünes "Schwein" */
            border: 3px solid white;
            border-radius: 50%;
            position: absolute;
            right: 30px;
            top: 400px;
            display: none; /* Standardmäßig versteckt */
            z-index: 5;
        }

        /* --- PUNKTEANZEIGE --- */
        #scoreDisplay {
            font-size: 3em;
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 10;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        /* --- NACHRICHTEN-OVERLAY (START, GAME OVER, BONUS) --- */
        #messageOverlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            display: flex; 
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            z-index: 20;
            display: none; /* Startet versteckt */
        }
        #messageOverlay h1 { margin-bottom: 10px; }
        #messageOverlay p { font-size: 1.2em; }
        
        /* ============================================= */
        /* --- CSS-ZUSTÄNDE (Das Gehirn für CSS) --- */
        /* ============================================= */
        
        /* Modus 1: Fliegen */
        .state-flying #target { display: none; }
        .state-flying #vogel { cursor: pointer; }
        
        /* Modus 2: Schleuder */
        .state-slingshot #target { display: block; }
        .state-slingshot .obstacle { display: none; }
        .state-slingshot #scoreDisplay { display: none; }
        .state-slingshot #vogel {
            /* Startposition für Schleuder */
            top: 450px;
            left: 75px;
            background-image: url('vogel_5.png'); /* Immer der goldene Vogel */
            cursor: grab; /* Zeigt an, dass man ziehen kann */
        }
        .state-slingshot #vogel.dragging {
            cursor: grabbing; /* Beim Ziehen */
        }

        /* Versteckt alles, wenn das Spiel vorbei ist oder startet */
        .state-start .obstacle, .state-start #target { display: none; }
        .state-game-over .obstacle, .state-game-over #target { display: none; }

    </style>
</head>
<body>

    <h1>Vogel-Evolution</h1>

    <audio id="backgroundMusic" src="musik.mp3" loop></audio>
    <audio id="soundFlap" src="flap.mp3"></audio>
    <audio id="soundScore" src="score.mp3"></audio>
    <audio id="soundHit" src="hit.mp3"></audio>
    <audio id="soundDie" src="die.mp3"></audio>
    <audio id="soundRelease" src="release.mp3"></audio>
    <audio id="soundWin" src="win.mp3"></audio>

    <div id="gameContainer">
        <div id="vogel"></div>
        <div id="target"></div> 
        <div id="scoreDisplay">0</div>
        <div id="messageOverlay">
            <h1 id="messageTitle"></h1>
            <p id="messageText"></p>
        </div>
    </div>

    <script>
        // ======================================================
        // 1. DOM-ELEMENTE HOLEN
        // ======================================================
        const gameContainer = document.getElementById('gameContainer');
        const vogel = document.getElementById('vogel');
        const target = document.getElementById('target');
        const scoreDisplay = document.getElementById('scoreDisplay');
        const messageOverlay = document.getElementById('messageOverlay');
        const messageTitle = document.getElementById('messageTitle');
        const messageText = document.getElementById('messageText');

        // NEU: Alle Audio-Elemente holen
        const backgroundMusic = document.getElementById('backgroundMusic');
        const soundFlap = document.getElementById('soundFlap');
        const soundScore = document.getElementById('soundScore');
        const soundHit = document.getElementById('soundHit');
        const soundDie = document.getElementById('soundDie');
        const soundRelease = document.getElementById('soundRelease');
        const soundWin = document.getElementById('soundWin');

        // ======================================================
        // 2. DAS "GEHIRN": SPIELZUSTÄNDE
        // ======================================================
        const GAME_STATE_START = 'START';
        const GAME_STATE_FLYING = 'FLYING';
        const GAME_STATE_SLINGSHOT = 'SLINGSHOT';
        const GAME_STATE_GAME_OVER = 'GAME_OVER';
        
        let currentGameState = GAME_STATE_START;
        
        // ======================================================
        // 3. SPIEL-KONSTANTEN & VARIABLEN
        // ======================================================
        
        // --- Physik & Steuerung (Modus 1) ---
        const gravity = 6;
        const flapStrength = -80; 
        let vogelVelocity = 0; 
        let vogelX = 75;
        let vogelY = 250;
        
        // --- Vogel-Evolution (Extra-Leben) ---
        const vogelImages = ['vogel_1.png', 'vogel_2.png', 'vogel_3.png', 'vogel_4.png', 'vogel_5.png'];
        let currentBirdIndex = 0;
        let isInvincible = false; // Für Unbesiegbarkeit nach Treffer

        // --- Punkte & Ziele ---
        let score = 0;
        const scoreForBonusLevel = 10; 

        // --- Hindernisse ---
        let obstacles = []; 
        const obstacleWidth = 60;
        const obstacleGap = 200; 
        const obstacleSpeed = 4;
        const obstacleSpawnRate = 100; 
        let frameCounter = 0;
        
        // --- Schleuder (Modus 2) ---
        let isDragging = false;
        let startX = 0, startY = 0;
        let vogelLaunchVX = 0; // Horizontale Geschwindigkeit
        let vogelLaunchVY = 0; // Vertikale Geschwindigkeit
        let birdInFlight = false; // Fliegt der Vogel (in Modus 2)?
        const slingshotStrength = 0.2; // Multiplikator
        const slingshotGravity = 0.5; // Stärkere Schwerkraft

        // --- Spiel-Loop ---
        let gameLoopInterval = null;
        
        // ======================================================
        // 3.5 AUDIO-HELFERFUNKTION (NEU)
        // ======================================================
        
        /** * Spielt einen Soundeffekt ab. 
         * Setzt ihn auf 0 zurück, damit er schnell hintereinander abgespielt werden kann.
         */
        function playSound(sound) {
            sound.currentTime = 0; // WICHTIG: Sound zurückspulen
            sound.play();
        }

        // ======================================================
        // 4. DIE HAUPT-SPIELSCHLEIFE (GAME LOOP)
        // ======================================================
        
        function gameLoop() {
            switch (currentGameState) {
                case GAME_STATE_FLYING:
                    updateGame_Flying();
                    break;
                case GAME_STATE_SLINGSHOT:
                    updateGame_Slingshot();
                    break;
                case GAME_STATE_START:
                case GAME_STATE_GAME_OVER:
                    // Spiel pausiert
                    break;
            }
        }

        // ======================================================
        // 5. STATE-SPEZIFISCHE FUNKTIONEN
        // ======================================================

        /** MODUS 1: Wird 60x pro Sekunde im FLIEGEN-Modus aufgerufen. */
        function updateGame_Flying() {
            // 1. Vogel-Physik
            vogelVelocity += (gravity * 0.1); 
            vogelY += vogelVelocity;
            vogel.style.top = vogelY + 'px';
            vogel.style.transform = (vogelVelocity < 0) ? 'rotate(-20deg)' : 'rotate(20deg)';

            // 2. Hindernisse spawnen & bewegen
            frameCounter++;
            if (frameCounter > obstacleSpawnRate) {
                createObstacle();
                frameCounter = 0;
            }
            moveObstacles();

            // 3. Kollision prüfen (nur wenn nicht unbesiegbar)
            if (!isInvincible && checkCollision()) {
                handleHit(); // Deine "Extra-Leben"-Logik
            } else if (!isInvincible) {
                // 4. Punkte zählen (nur wenn nicht unbesiegbar)
                updateScore();
            }
        }

        /** MODUS 2: Wird 60x pro Sekunde im SCHLEUDER-Modus aufgerufen. */
        function updateGame_Slingshot() {
            if (!birdInFlight) return;

            vogelLaunchVY += slingshotGravity; 
            vogelX += vogelLaunchVX;
            vogelY += vogelLaunchVY;

            vogel.style.left = vogelX + 'px';
            vogel.style.top = vogelY + 'px';

            const vogelRect = vogel.getBoundingClientRect();
            const targetRect = target.getBoundingClientRect();

            if (vogelRect.left < targetRect.right &&
                vogelRect.right > targetRect.left &&
                vogelRect.top < targetRect.bottom &&
                vogelRect.bottom > targetRect.top) {
                
                winGame(); // TREFFER!
                return;
            }

            const gameRect = gameContainer.getBoundingClientRect();
            if (vogelY > gameRect.height || vogelX > gameRect.width || vogelX < -vogelRect.width) {
                missSlingshot(); // Verfehlt!
            }
        }

        /** Zeigt den Startbildschirm */
        function showStartScreen() {
            currentGameState = GAME_STATE_START;
            gameContainer.className = 'state-start';
            messageTitle.innerText = "Vogel-Evolution";
            messageText.innerText = "Klicke oder drücke 'Space', um zu starten!";
            messageOverlay.style.display = 'flex';
            resetGame(); 
        }

        /** Startet das Spiel (Modus 1) */
        function startGame() {
            if (currentGameState === GAME_STATE_FLYING) return; 
            
            if (currentGameState === GAME_STATE_GAME_OVER || currentGameState === GAME_STATE_START) {
                resetGame();
            }

            messageOverlay.style.display = 'none';
            currentGameState = GAME_STATE_FLYING;
            gameContainer.className = 'state-flying';
            gameLoopInterval = setInterval(gameLoop, 1000 / 60); 
            
            // MUSIK STARTEN
            backgroundMusic.play();
        }
        
        /** Beendet das Spiel (Game Over) */
        function endGame() {
            clearInterval(gameLoopInterval); 
            currentGameState = GAME_STATE_GAME_OVER;
            gameContainer.className = 'state-game-over';
            
            messageTitle.innerText = "Game Over";
            messageText.innerText = `Dein Score: ${score}\nKlicke, um neu zu starten.`;
            messageOverlay.style.display = 'flex';

            // MUSIK & SOUNDS
            backgroundMusic.pause();
            backgroundMusic.currentTime = 0;
            playSound(soundDie); // NEU
        }

        /** Setzt alle Variablen für einen Neustart zurück */
        function resetGame() {
            vogelY = 250;
            vogelVelocity = 0;
            vogel.style.top = vogelY + 'px';
            vogel.style.left = vogelX + 'px';
            vogel.style.transform = 'rotate(0deg)';
            
            score = 0;
            scoreDisplay.textContent = score;
            scoreDisplay.style.display = 'block';

            currentBirdIndex = 0;
            vogel.style.backgroundImage = `url('${vogelImages[currentBirdIndex]}')`;
            isInvincible = false;
            vogel.style.opacity = '1';

            obstacles.forEach(ob => ob.element.remove());
            obstacles = [];
            
            frameCounter = 0;
            
            target.style.display = 'none';
            resetSlingshotBird();
        }

        // ======================================================
        // 6. MODUS 1: HELFER-FUNKTIONEN (Fliegen)
        // ======================================================

        function flap() { 
            vogelVelocity = flapStrength * 0.1; 
            playSound(soundFlap); // NEU
        }
        
        function createObstacle() {
            const gapTop = Math.random() * (gameContainer.clientHeight - obstacleGap - 100) + 50;
            const gapBottom = gapTop + obstacleGap;

            const topObstacle = document.createElement('div');
            topObstacle.classList.add('obstacle', 'top');
            topObstacle.style.height = gapTop + 'px';
            topObstacle.style.left = gameContainer.clientWidth + 'px';
            topObstacle.style.top = '0px';

            const bottomObstacle = document.createElement('div');
            bottomObstacle.classList.add('obstacle', 'bottom');
            bottomObstacle.style.height = (gameContainer.clientHeight - gapBottom) + 'px';
            bottomObstacle.style.left = gameContainer.clientWidth + 'px';
            bottomObstacle.style.top = gapBottom + 'px';
            
            gameContainer.appendChild(topObstacle);
            gameContainer.appendChild(bottomObstacle);
            
            obstacles.push({
                element: topObstacle,
                x: gameContainer.clientWidth,
                passed: false
            }, {
                element: bottomObstacle,
                x: gameContainer.clientWidth,
                passed: false
            });
        }

        function moveObstacles() {
            for (let i = obstacles.length - 1; i >= 0; i--) {
                let ob = obstacles[i];
                ob.x -= obstacleSpeed;
                ob.element.style.left = ob.x + 'px';

                if (ob.x + obstacleWidth < 0) {
                    ob.element.remove();
                    obstacles.splice(i, 1);
                }
            }
        }

        function checkCollision() {
            const vogelRect = vogel.getBoundingClientRect();
            if (vogelRect.bottom > gameContainer.clientHeight || vogelRect.top < 0) return true;

            const gameRect = gameContainer.getBoundingClientRect();
            for (let ob of obstacles) {
                const obRect = ob.element.getBoundingClientRect();
                
                const vogelLeft = vogelX;
                const vogelRight = vogelX + vogelRect.width;
                const vogelTop = vogelY;
                const vogelBottom = vogelY + vogelRect.height;
                
                const obLeft = ob.x;
                const obRight = ob.x + obRect.width;
                const obTop = (ob.element.classList.contains('top')) ? 0 : obRect.top - gameRect.top;
                const obBottom = (ob.element.classList.contains('top')) ? obRect.bottom - gameRect.top : gameContainer.clientHeight;
                
                if (vogelRight > obLeft && vogelLeft < obRight) {
                    // Kollision nur prüfen, wenn die X-Positionen übereinstimmen
                    if (ob.element.classList.contains('top') && vogelTop < (obRect.bottom - gameRect.top)) {
                         return true; 
                    }
                    if (ob.element.classList.contains('bottom') && vogelBottom > (obRect.top - gameRect.top)) {
                         return true; 
                    }
                }
            }
            return false;
        }

        function updateScore() {
            let scoreObstacles = obstacles.filter(ob => ob.element.classList.contains('top'));

            for (let ob of scoreObstacles) {
                if (!ob.passed && ob.x + obstacleWidth < vogelX) {
                    ob.passed = true;
                    score++;
                    scoreDisplay.textContent = score;
                    
                    playSound(soundScore); // NEU

                    if (score >= scoreForBonusLevel) {
                        switchToSlingshotMode();
                    } else {
                        checkBirdEvolution();
                    }
                }
            }
        }
        
        function checkBirdEvolution() {
            const newBirdIndex = Math.floor(score / 2); // Alle 2 Punkte
            if (newBirdIndex > currentBirdIndex && newBirdIndex < vogelImages.length) {
                currentBirdIndex = newBirdIndex;
                vogel.style.backgroundImage = `url('${vogelImages[currentBirdIndex]}')`;
            }
        }

        /** Deine "Extra-Leben"-Logik */
        function handleHit() {
            playSound(soundHit); // NEU
            
            if (currentBirdIndex > 0) {
                currentBirdIndex--; 
                vogel.style.backgroundImage = `url('${vogelImages[currentBirdIndex]}')`;
                makeInvincible(2000); // 2 Sek. unbesiegbar
            } else {
                endGame();
            }
        }

        function makeInvincible(durationMs) {
            isInvincible = true;
            vogel.style.opacity = '0.5';
            setTimeout(() => {
                isInvincible = false;
                vogel.style.opacity = '1';
            }, durationMs);
        }
        
        // ======================================================
        // 7. MODUS 2: HELFER-FUNKTIONEN (Schleuder)
        // ======================================================
        
        /** Löst den Wechsel zu Modus 2 aus */
        function switchToSlingshotMode() {
            clearInterval(gameLoopInterval); 
            currentGameState = GAME_STATE_SLINGSHOT;
            gameContainer.className = 'state-slingshot';
            
            obstacles.forEach(ob => ob.element.remove());
            obstacles = [];
            
            resetSlingshotBird();
            
            messageTitle.innerText = "Bonus-Level!";
            messageText.innerText = "Zieh den goldenen Vogel und triff das Ziel!";
            messageOverlay.style.display = 'flex';
            
            // Hält die Haupt-Spielmusik an (optional)
            backgroundMusic.pause();

            setTimeout(() => {
                messageOverlay.style.display = 'none';
                gameLoopInterval = setInterval(gameLoop, 1000 / 60);
            }, 3000);
        }
        
        /** Setzt den Vogel für den Schleuder-Modus zurück */
        function resetSlingshotBird() {
            birdInFlight = false;
            vogelLaunchVX = 0;
            vogelLaunchVY = 0;
            
            vogelX = 75; // Start-X
            vogelY = 450; // Start-Y
            vogel.style.left = vogelX + 'px';
            vogel.style.top = vogelY + 'px';
            vogel.style.transform = 'rotate(0deg)';
            vogel.style.opacity = '1';
            
            target.style.backgroundColor = '#4CAF50'; 
        }

        /** Wird aufgerufen, wenn das Schleuder-Ziel getroffen wird */
        function winGame() {
            clearInterval(gameLoopInterval);
            currentGameState = GAME_STATE_GAME_OVER; 
            gameContainer.className = 'state-game-over';
            target.style.backgroundColor = 'orange'; 

            messageTitle.innerText = "GEWONNEN!";
            messageText.innerText = "Du hast das Spiel gemeistert!\nKlicke, um von vorn zu beginnen.";
            messageOverlay.style.display = 'flex';

            playSound(soundWin); // NEU
            backgroundMusic.pause();
            backgroundMusic.currentTime = 0;
        }

        /** Wird aufgerufen, wenn der Vogel das Ziel verfehlt */
        function missSlingshot() {
            messageTitle.innerText = "Verfehlt!";
            messageText.innerText = "Zieh den Vogel erneut!";
            messageOverlay.style.display = 'flex';

            resetSlingshotBird(); // Vogel zurücksetzen für neuen Versuch

            setTimeout(() => {
                messageOverlay.style.display = 'none';
            }, 1500);
        }

        // ======================================================
        // 8. EVENT LISTENER (BENUTZEREINGABEN)
        // ======================================================

        /** Reagiert auf Klicks oder Tasten (Modus 1 & Menüs) */
        function handleInput(event) {
            event.preventDefault(); 
            
            switch (currentGameState) {
                case GAME_STATE_START:
                    startGame();
                    break;
                case GAME_STATE_FLYING:
                    flap();
                    break;
                case GAME_STATE_GAME_OVER:
                    showStartScreen(); 
                    break;
            }
        }

        document.addEventListener('mousedown', handleInput);
        document.addEventListener('keydown', (e) => {
            if (e.code === 'Space' || e.code === 'Enter' || e.code === 'ArrowUp') {
                handleInput(e);
            }
        });

        // --- EVENT LISTENER FÜR SCHLEUDER (Modus 2) ---

        gameContainer.addEventListener('mousedown', (e) => {
            if (currentGameState !== GAME_STATE_SLINGSHOT || birdInFlight) return;
            
            const vogelRect = vogel.getBoundingClientRect();
            if (e.clientX >= vogelRect.left && e.clientX <= vogelRect.right &&
                e.clientY >= vogelRect.top && e.clientY <= vogelRect.bottom) {
                
                isDragging = true;
                vogel.classList.add('dragging');
                startX = vogelX;
                startY = vogelY;
                vogel.style.transition = 'none'; 
            }
        });

        gameContainer.addEventListener('mousemove', (e) => {
            if (!isDragging) return;

            const gameRect = gameContainer.getBoundingClientRect();
            let mouseX = e.clientX - gameRect.left;
            let mouseY = e.clientY - gameRect.top;

            const pullLimit = 50;
            let deltaX = mouseX - startX;
            let deltaY = mouseY - startY;

            const dist = Math.sqrt(deltaX * deltaX + deltaY * deltaY);
            if (dist > pullLimit) {
                deltaX = (deltaX / dist) * pullLimit;
                deltaY = (deltaY / dist) * pullLimit;
            }

            vogelX = startX + deltaX;
            vogelY = startY + deltaY;
            vogel.style.left = vogelX + 'px';
            vogel.style.top = vogelY + 'px';
        });

        gameContainer.addEventListener('mouseup', (e) => {
            if (!isDragging) return;

            isDragging = false;
            birdInFlight = true;
            vogel.classList.remove('dragging');
            vogel.style.transition = ''; 
            
            let deltaX = startX - vogelX;
            let deltaY = startY - vogelY;
            
            vogelLaunchVX = deltaX * slingshotStrength;
            vogelLaunchVY = deltaY * slingshotStrength;
            
            playSound(soundRelease); // NEU
        });
        
        vogel.addEventListener('mousedown', (e) => {
             if (currentGameState === GAME_STATE_SLINGSHOT) {
                e.stopPropagation(); 
             }
        });

        // ======================================================
        // 9. SPIEL STARTEN
        // ======================================================
        showStartScreen(); 

    </script>
</body>
</html>
